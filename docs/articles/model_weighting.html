<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model weighting with rTPC â€¢ rTPC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model weighting with rTPC">
<meta property="og:description" content="rTPC">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74093873-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-74093873-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rTPC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/rTPC.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Fitting a single curve</li>
    <li>
      <a href="../articles/fit_many_models.html">Fitting many models with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_weighting.html">Model weighting with rTPC</a>
    </li>
    <li>
      <a href="../articles/model_averaging_selection.html">Model selection and model averaging with rTPC</a>
    </li>
    <li>
      <a href="../articles/bootstrapping_models.html">Bootstrapping using rTPC</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Fitting many curves</li>
    <li>
      <a href="../articles/fit_many_curves.html">Fitting many curves using rTPC</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/padpadpadpad/rTPC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_weighting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model weighting with rTPC</h1>
                        <h4 class="author">Daniel Padfield</h4>
            
            <h4 class="date">2020-07-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/padpadpadpad/rTPC/blob/master/vignettes/model_weighting.Rmd"><code>vignettes/model_weighting.Rmd</code></a></small>
      <div class="hidden name"><code>model_weighting.Rmd</code></div>

    </div>

    
    
<div id="a-brief-example-of-how-model-weighting-can-be-used-to-help-account-for-measurement-uncertainty-when-fitting-models-to-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-" class="section level4">
<h4 class="hasAnchor">
<a href="#a-brief-example-of-how-model-weighting-can-be-used-to-help-account-for-measurement-uncertainty-when-fitting-models-to-tpcs-using-rtpc-nls-multstart-and-the-tidyverse-" class="anchor"></a>A brief example of how model weighting can be used to help account for measurement uncertainty when fitting models to TPCs using rTPC, nls.multstart, and the tidyverse.</h4>
<hr>
</div>
<div id="things-to-consider" class="section level2">
<h2 class="hasAnchor">
<a href="#things-to-consider" class="anchor"></a>Things to consider</h2>
<ul>
<li>The optimal weighting is <span class="math inline">\(\frac{1}{\sigma}\)</span>. The standard deviation is easy to calculate when calculating the means of the rate data.</li>
<li>Carefully consider your level of replication before undertaking your statistical analysis.
<ul>
<li>What is your level of replication?</li>
<li>Do you have biological replicates or technical replicates?</li>
<li>Do you have non-independence in your dataset?</li>
</ul>
</li>
</ul>
<hr>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rTPC</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nls.multstart</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">broom</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggrepel</span>)</pre></body></html></div>
<p>The general pipeline demonstrates how models can be fitted, parameters extracted, and predictions plotted to single or multiple curves using functions in <strong>rTPC</strong>, <strong>nls_multstart()</strong>, and <strong>purrr</strong>.</p>
</div>
<div id="using-model-weights" class="section level2">
<h2 class="hasAnchor">
<a href="#using-model-weights" class="anchor"></a>Using model weights</h2>
<p>Here, we demonstrate how this pipeline can easily be extended to incorporate measurement uncertainty by using the <code>weights</code> argument of <strong>nls_multstart()</strong>. Methods of fitting TPCs in the literature often fit models to averaged rate values at each temperature. This fits a model on the mean rate value, but often the variation around this calculated mean value is ignored. However, there may be more spread in the rate data at the extreme temperatures (very hot or very cold). Ignoring the homoscedasticity in the data may alter the model fit.</p>
<p>Instead, we can incorporate measurement uncertainty using the <strong>weights</strong> argument within <strong>nls_multstart()</strong>, to perform a weighted non-linear least squares regression. The optimal weight for each data point is the standard deviation, <span class="math inline">\(1/\sigma\)</span>, which easily be calculated when averaging over technical or biological replicates.</p>
<p>We can demonstrate weighted non-linear least squares regression by using the example dataset contained within <strong>rTPC</strong> - a dataset of 60 TPCs of respiration and photosynthesis of the aquatic algae, <em>Chlorella vulgaris</em>. Instead of plotting a single curve, we average over the biological replicates, <code>rep</code>, within a growth temperature, to get mean rate values at each assay temperature and their standard deviation. These are then plotted using <strong>ggplot2</strong>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># get curve data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"chlorella_tpc"</span>)

<span class="no">d_ave</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">chlorella_tpc</span>, <span class="no">process</span> <span class="kw">==</span> <span class="st">'adaptation'</span>, <span class="no">growth_temp</span> <span class="kw">==</span> <span class="fl">33</span>, <span class="no">flux</span> <span class="kw">==</span> <span class="st">'photosynthesis'</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">temp</span>, <span class="no">flux</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarise</span>(<span class="no">.</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span>(<span class="no">rate</span>),
            <span class="kw">ave_rate</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">rate</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()
<span class="co">#&gt; `summarise()` regrouping output by 'temp' (override with `.groups` argument)</span>

<span class="co"># plot</span>
<span class="fu">ggplot</span>() +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>,
        <span class="kw">strip.text</span> <span class="kw">=</span> <span class="fu">element_text</span>(<span class="kw">hjust</span> <span class="kw">=</span> <span class="fl">0</span>),
        <span class="kw">strip.background</span> <span class="kw">=</span> <span class="fu">element_blank</span>()) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span><span class="st">'Temperature (ÂºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p><img src="model_weighting_files/figure-html/get_data-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this example, the standard deviation in our rates are actually smallest at the extreme temperatures, counter to what we previously expected.</p>
<p>We will use the workflows outlined in the previous vignettes on <a href="fit_many_models.html">fitting many models</a> and <a href="fit_many_curves.html">fitting many curves</a> to fit both weighted and standard non-linear least squares regression, and we will use the <strong>kamykowski_1985()</strong> in this example - purely because it has not been used in previous vignettes as of yet.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># fit kamykowski model using rTPC with and without weights</span>
<span class="no">d_fits</span> <span class="kw">&lt;-</span> <span class="fu">nest</span>(<span class="no">d_ave</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">temp</span>, <span class="no">ave_rate</span>, <span class="no">sd</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">standard</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">data</span>, ~<span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html">nls_multstart</a></span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/kamykowski_1985.html">kamykowski_1985</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">tmin</span>, <span class="no">tmax</span>, <span class="no">a</span>,<span class="no">b</span>,<span class="no">c</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>)),
         <span class="kw">weighted</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">data</span>, ~<span class="fu"><a href="https://rdrr.io/pkg/nls.multstart/man/nls_multstart.html">nls_multstart</a></span>(<span class="no">ave_rate</span>~<span class="fu"><a href="../reference/kamykowski_1985.html">kamykowski_1985</a></span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="no">tmin</span>, <span class="no">tmax</span>, <span class="no">a</span>,<span class="no">b</span>,<span class="no">c</span>),
                        <span class="kw">data</span> <span class="kw">=</span> <span class="no">.x</span>,
                        <span class="kw">iter</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">4</span>),
                        <span class="kw">start_lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>) - <span class="fl">10</span>,
                        <span class="kw">start_upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_start_vals.html">get_start_vals</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>) + <span class="fl">10</span>,
                        <span class="kw">lower</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_lower_lims.html">get_lower_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>),
                        <span class="kw">upper</span> <span class="kw">=</span> <span class="fu"><a href="../reference/get_upper_lims.html">get_upper_lims</a></span>(<span class="no">.x</span>$<span class="no">temp</span>, <span class="no">.x</span>$<span class="no">ave_rate</span>, <span class="kw">model_name</span> <span class="kw">=</span> <span class="st">'kamykowski_1985'</span>),
                        <span class="kw">supp_errors</span> <span class="kw">=</span> <span class="st">'Y'</span>,
                        <span class="kw">convergence_count</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
                        <span class="co"># include weights here!</span>
                        <span class="kw">modelweights</span> <span class="kw">=</span> <span class="fl">1</span>/<span class="no">sd</span>)))

<span class="no">d_fits</span>
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   flux           data              standard weighted</span>
<span class="co">#&gt;   &lt;chr&gt;          &lt;list&gt;            &lt;list&gt;   &lt;list&gt;  </span>
<span class="co">#&gt; 1 photosynthesis &lt;tibble [11 Ã— 3]&gt; &lt;nls&gt;    &lt;nls&gt;</span></pre></body></html></div>
<p>We can then get the predictions and plot them as before.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># stack models</span>
<span class="no">d_stack</span> <span class="kw">&lt;-</span> <span class="fu">select</span>(<span class="no">d_fits</span>, -<span class="no">data</span>) <span class="kw">%&gt;%</span>
  <span class="fu">pivot_longer</span>(<span class="no">.</span>, <span class="kw">names_to</span> <span class="kw">=</span> <span class="st">'model_name'</span>, <span class="kw">values_to</span> <span class="kw">=</span> <span class="st">'fit'</span>, <span class="no">standard</span>:<span class="no">weighted</span>)

<span class="co"># get predictions using augment</span>
<span class="no">newdata</span> <span class="kw">&lt;-</span> <span class="fu">tibble</span>(<span class="kw">temp</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">d_ave</span>$<span class="no">temp</span>), <span class="kw">length.out</span> <span class="kw">=</span> <span class="fl">100</span>))
<span class="no">d_preds</span> <span class="kw">&lt;-</span> <span class="no">d_stack</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="no">.</span>, <span class="kw">preds</span> <span class="kw">=</span> <span class="fu">map</span>(<span class="no">fit</span>, <span class="no">augment</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newdata</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">select</span>(-<span class="no">fit</span>) <span class="kw">%&gt;%</span>
  <span class="fu">unnest</span>(<span class="no">preds</span>)

<span class="co"># take a random point from each model for labelling</span>
<span class="no">d_labs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">d_preds</span>, <span class="no">temp</span> <span class="kw">&lt;</span> <span class="fl">30</span>) <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">.</span>, <span class="no">model_name</span>) <span class="kw">%&gt;%</span>
  <span class="fu">sample_n</span>(<span class="no">.</span>, <span class="fl">1</span>) <span class="kw">%&gt;%</span>
  <span class="fu">ungroup</span>()

<span class="co"># get topt for each model</span>
<span class="no">d_topt</span> <span class="kw">&lt;-</span> <span class="fu">mutate</span>(<span class="no">d_stack</span>, <span class="kw">topt</span> <span class="kw">=</span> <span class="fu">map_dbl</span>(<span class="no">fit</span>, <span class="no">get_topt</span>), <span class="kw">rmax</span> <span class="kw">=</span> <span class="fu">map_dbl</span>(<span class="no">fit</span>, <span class="no">get_rmax</span>),
                 <span class="kw">topt_text</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">topt</span>, <span class="st">'ÂºC'</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">' '</span>))

<span class="co"># plot</span>
<span class="fu">ggplot</span>(<span class="no">d_preds</span>) +
  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">model_name</span>)) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">.fitted</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">model_name</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">model_name</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'white'</span>, <span class="kw">nudge_y</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">segment.size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">segment.colour</span> <span class="kw">=</span> <span class="st">'grey50'</span>, <span class="no">d_labs</span>) +
  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">temp</span>, <span class="kw">ymin</span> <span class="kw">=</span> <span class="no">ave_rate</span> - <span class="no">sd</span>, <span class="kw">ymax</span> <span class="kw">=</span> <span class="no">ave_rate</span> + <span class="no">sd</span>), <span class="no">d_ave</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">temp</span>, <span class="no">ave_rate</span>), <span class="no">d_ave</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">21</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'green4'</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span>(<span class="fu">aes</span>(<span class="no">topt</span>, <span class="no">rmax</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">topt_text</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">model_name</span>), <span class="kw">fill</span> <span class="kw">=</span> <span class="st">'white'</span>, <span class="kw">nudge_y</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">segment.size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">segment.colour</span> <span class="kw">=</span> <span class="st">'grey50'</span>, <span class="no">d_topt</span>) +
  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="no">topt</span>, <span class="no">rmax</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">model_name</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="no">d_topt</span>) +
  <span class="fu">theme_bw</span>(<span class="kw">base_size</span> <span class="kw">=</span> <span class="fl">12</span>) +
  <span class="fu">theme</span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">'none'</span>) +
  <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Temperature (ÂºC)'</span>,
       <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Metabolic rate'</span>,
       <span class="kw">title</span> <span class="kw">=</span> <span class="st">'Photosynthesis rates across temperatures'</span>) +
  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="kw">yintercept</span> <span class="kw">=</span> <span class="fl">0</span>), <span class="kw">linetype</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">scale_color_brewer</span>(<span class="kw">type</span> <span class="kw">=</span> <span class="st">'qual'</span>, <span class="kw">palette</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.window.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">3</span>))</pre></body></html></div>
<p><img src="model_weighting_files/figure-html/preds_and_plot-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Here, we can see that weighting the regression by the standard deviation of the average rate value at each temperature increases the optimum temperature by approximately 2 ÂºC. This is a big relative shift, and could have big consequences for any downstream analyses that might be applied. The model weighting approach can easily be combined with <a href="model_averaging_selection.html">model selection/averaging</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Daniel Padfield, Hannah O'Sullivan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
